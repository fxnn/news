<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Newsletter Stories</title>
    <style>
        body { font-family: sans-serif; margin: 20px; background-color: #f4f4f4; color: #000; }
        h1 { text-align: center; color: #000; font-family: serif; }
        .container { max-width: 600px; margin: auto; background: #fff; padding: 20px; border: 1px solid #000; }
        .story { border-bottom: 1px solid #000; padding-bottom: 15px; margin-bottom: 15px; }
        .story:last-child { border-bottom: none; }
        .story h2 { margin-top: 0; color: #000; font-family: serif; }
        .story p { margin-bottom: 5px; }
        .story .story-meta { color: #777; font-size: 0.9em; margin-bottom: 10px; } /* New style for source/date */
        .story a { color: #000; text-decoration: none; }
        .story a:hover { text-decoration: underline; }
        .read-more-link { font-weight: bold; font-family: serif; } /* Style for "Read more" links */
        #error-message { color: #000; text-align: center; } /* Changed to black as per b/w scheme */
        #loading-message { text-align: center; font-style: italic; color: #000; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Latest Newsletter Stories</h1>
        <div id="loading-message">Loading stories...</div>
        <div id="error-message"></div>
        <div id="stories-container">
            <!-- Stories will be injected here by JavaScript -->
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const storiesContainer = document.getElementById('stories-container');
            const errorMessageDiv = document.getElementById('error-message');
            const loadingMessageDiv = document.getElementById('loading-message');

            fetch('/stories')
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(stories => {
                    loadingMessageDiv.style.display = 'none'; // Hide loading message
                    if (stories && stories.length > 0) {
                        stories.forEach(story => {
                            const storyElement = document.createElement('div');
                            storyElement.classList.add('story');

                            const headlineElement = document.createElement('h2');
                            if (story.URL) {
                                const headlineLink = document.createElement('a');
                                headlineLink.href = story.URL;
                                headlineLink.target = '_blank';
                                headlineLink.textContent = story.Headline;
                                headlineElement.appendChild(headlineLink);
                            } else {
                                headlineElement.textContent = story.Headline;
                            }
                            storyElement.appendChild(headlineElement);

                            // Create a single paragraph for source and date
                            const metaPara = document.createElement('p');
                            metaPara.classList.add('story-meta');
                            let metaText = [];
                            if (story.Source) {
                                metaText.push(`Source: ${story.Source}`);
                            }
                            if (story.PublishedDate) {
                                metaText.push(`Published: ${new Date(story.PublishedDate).toLocaleString()}`);
                            }
                            if (metaText.length > 0) {
                                metaPara.textContent = metaText.join(' | ');
                                storyElement.appendChild(metaPara);
                            }

                            const teaser = document.createElement('p');
                            let teaserContent = story.Teaser;
                            if (story.URL) {
                                teaserContent += ' '; // Add a space before the link
                                const urlLink = document.createElement('a');
                                urlLink.href = story.URL;
                                urlLink.textContent = 'Read more';
                                urlLink.target = '_blank'; // Open in new tab
                                urlLink.classList.add('read-more-link'); // Apply the new style
                                // Append link HTML as string to teaser content for inline display
                                teaser.innerHTML = teaserContent; // Use innerHTML to parse the <a> tag
                                teaser.appendChild(urlLink); // Append the actual node
                            } else {
                                teaser.textContent = teaserContent;
                            }
                            storyElement.appendChild(teaser);
                            storiesContainer.appendChild(storyElement);
                        });
                    } else {
                        storiesContainer.textContent = 'No stories available at the moment.';
                    }
                })
                .catch(error => {
                    loadingMessageDiv.style.display = 'none'; // Hide loading message
                    console.error('Error fetching stories:', error);
                    errorMessageDiv.textContent = 'Failed to load stories. Please try again later.';
                });
        });
    </script>
</body>
</html>
